(()=>{"use strict";var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};function t(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}function n(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var o,r,s=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(o=s.next()).done;)i.push(o.value)}catch(e){r={error:e}}finally{try{o&&!o.done&&(n=s.return)&&n.call(s)}finally{if(r)throw r.error}}return i}function o(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(n(arguments[t]));return e}var r=function(e,t){this.target=t,this.type=e},s=function(e){function n(t,n){var o=e.call(this,"error",n)||this;return o.message=t.message,o.error=t,o}return t(n,e),n}(r),i=function(e){function n(t,n,o){void 0===t&&(t=1e3),void 0===n&&(n="");var r=e.call(this,"close",o)||this;return r.wasClean=!0,r.code=t,r.reason=n,r}return t(n,e),n}(r),u=function(){if("undefined"!=typeof WebSocket)return WebSocket},a={maxReconnectionDelay:1e4,minReconnectionDelay:1e3+4e3*Math.random(),minUptime:5e3,reconnectionDelayGrowFactor:1.3,connectionTimeout:4e3,maxRetries:1/0,maxEnqueuedMessages:1/0,startClosed:!1,debug:!1};const c=function(){function e(e,t,n){var o=this;void 0===n&&(n={}),this._listeners={error:[],message:[],open:[],close:[]},this._retryCount=-1,this._shouldReconnect=!0,this._connectLock=!1,this._binaryType="blob",this._closeCalled=!1,this._messageQueue=[],this.onclose=null,this.onerror=null,this.onmessage=null,this.onopen=null,this._handleOpen=function(e){o._debug("open event");var t=o._options.minUptime,n=void 0===t?a.minUptime:t;clearTimeout(o._connectTimeout),o._uptimeTimeout=setTimeout((function(){return o._acceptOpen()}),n),o._ws.binaryType=o._binaryType,o._messageQueue.forEach((function(e){return o._ws.send(e)})),o._messageQueue=[],o.onopen&&o.onopen(e),o._listeners.open.forEach((function(t){return o._callEventListener(e,t)}))},this._handleMessage=function(e){o._debug("message event"),o.onmessage&&o.onmessage(e),o._listeners.message.forEach((function(t){return o._callEventListener(e,t)}))},this._handleError=function(e){o._debug("error event",e.message),o._disconnect(void 0,"TIMEOUT"===e.message?"timeout":void 0),o.onerror&&o.onerror(e),o._debug("exec error listeners"),o._listeners.error.forEach((function(t){return o._callEventListener(e,t)})),o._connect()},this._handleClose=function(e){o._debug("close event"),o._clearTimeouts(),o._shouldReconnect&&o._connect(),o.onclose&&o.onclose(e),o._listeners.close.forEach((function(t){return o._callEventListener(e,t)}))},this._url=e,this._protocols=t,this._options=n,this._options.startClosed&&(this._shouldReconnect=!1),this._connect()}return Object.defineProperty(e,"CONNECTING",{get:function(){return 0},enumerable:!0,configurable:!0}),Object.defineProperty(e,"OPEN",{get:function(){return 1},enumerable:!0,configurable:!0}),Object.defineProperty(e,"CLOSING",{get:function(){return 2},enumerable:!0,configurable:!0}),Object.defineProperty(e,"CLOSED",{get:function(){return 3},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"CONNECTING",{get:function(){return e.CONNECTING},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"OPEN",{get:function(){return e.OPEN},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"CLOSING",{get:function(){return e.CLOSING},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"CLOSED",{get:function(){return e.CLOSED},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"binaryType",{get:function(){return this._ws?this._ws.binaryType:this._binaryType},set:function(e){this._binaryType=e,this._ws&&(this._ws.binaryType=e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"retryCount",{get:function(){return Math.max(this._retryCount,0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bufferedAmount",{get:function(){return this._messageQueue.reduce((function(e,t){return"string"==typeof t?e+=t.length:t instanceof Blob?e+=t.size:e+=t.byteLength,e}),0)+(this._ws?this._ws.bufferedAmount:0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"extensions",{get:function(){return this._ws?this._ws.extensions:""},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"protocol",{get:function(){return this._ws?this._ws.protocol:""},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"readyState",{get:function(){return this._ws?this._ws.readyState:this._options.startClosed?e.CLOSED:e.CONNECTING},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"url",{get:function(){return this._ws?this._ws.url:""},enumerable:!0,configurable:!0}),e.prototype.close=function(e,t){void 0===e&&(e=1e3),this._closeCalled=!0,this._shouldReconnect=!1,this._clearTimeouts(),this._ws?this._ws.readyState!==this.CLOSED?this._ws.close(e,t):this._debug("close: already closed"):this._debug("close enqueued: no ws instance")},e.prototype.reconnect=function(e,t){this._shouldReconnect=!0,this._closeCalled=!1,this._retryCount=-1,this._ws&&this._ws.readyState!==this.CLOSED?(this._disconnect(e,t),this._connect()):this._connect()},e.prototype.send=function(e){if(this._ws&&this._ws.readyState===this.OPEN)this._debug("send",e),this._ws.send(e);else{var t=this._options.maxEnqueuedMessages,n=void 0===t?a.maxEnqueuedMessages:t;this._messageQueue.length<n&&(this._debug("enqueue",e),this._messageQueue.push(e))}},e.prototype.addEventListener=function(e,t){this._listeners[e]&&this._listeners[e].push(t)},e.prototype.dispatchEvent=function(e){var t,n,o=this._listeners[e.type];if(o)try{for(var r=function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}}(o),s=r.next();!s.done;s=r.next()){var i=s.value;this._callEventListener(e,i)}}catch(e){t={error:e}}finally{try{s&&!s.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}return!0},e.prototype.removeEventListener=function(e,t){this._listeners[e]&&(this._listeners[e]=this._listeners[e].filter((function(e){return e!==t})))},e.prototype._debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._options.debug&&console.log.apply(console,o(["RWS>"],e))},e.prototype._getNextDelay=function(){var e=this._options,t=e.reconnectionDelayGrowFactor,n=void 0===t?a.reconnectionDelayGrowFactor:t,o=e.minReconnectionDelay,r=void 0===o?a.minReconnectionDelay:o,s=e.maxReconnectionDelay,i=void 0===s?a.maxReconnectionDelay:s,u=0;return this._retryCount>0&&(u=r*Math.pow(n,this._retryCount-1))>i&&(u=i),this._debug("next delay",u),u},e.prototype._wait=function(){var e=this;return new Promise((function(t){setTimeout(t,e._getNextDelay())}))},e.prototype._getNextUrl=function(e){if("string"==typeof e)return Promise.resolve(e);if("function"==typeof e){var t=e();if("string"==typeof t)return Promise.resolve(t);if(t.then)return t}throw Error("Invalid URL")},e.prototype._connect=function(){var e=this;if(!this._connectLock&&this._shouldReconnect){this._connectLock=!0;var t=this._options,n=t.maxRetries,o=void 0===n?a.maxRetries:n,r=t.connectionTimeout,s=void 0===r?a.connectionTimeout:r,i=t.WebSocket,c=void 0===i?u():i;if(this._retryCount>=o)this._debug("max retries reached",this._retryCount,">=",o);else{if(this._retryCount++,this._debug("connect",this._retryCount),this._removeListeners(),!function(e){return void 0!==e&&!!e&&2===e.CLOSING}(c))throw Error("No valid WebSocket class provided");this._wait().then((function(){return e._getNextUrl(e._url)})).then((function(t){e._closeCalled||(e._debug("connect",{url:t,protocols:e._protocols}),e._ws=e._protocols?new c(t,e._protocols):new c(t),e._ws.binaryType=e._binaryType,e._connectLock=!1,e._addListeners(),e._connectTimeout=setTimeout((function(){return e._handleTimeout()}),s))}))}}},e.prototype._handleTimeout=function(){this._debug("timeout event"),this._handleError(new s(Error("TIMEOUT"),this))},e.prototype._disconnect=function(e,t){if(void 0===e&&(e=1e3),this._clearTimeouts(),this._ws){this._removeListeners();try{this._ws.close(e,t),this._handleClose(new i(e,t,this))}catch(e){}}},e.prototype._acceptOpen=function(){this._debug("accept open"),this._retryCount=0},e.prototype._callEventListener=function(e,t){"handleEvent"in t?t.handleEvent(e):t(e)},e.prototype._removeListeners=function(){this._ws&&(this._debug("removeListeners"),this._ws.removeEventListener("open",this._handleOpen),this._ws.removeEventListener("close",this._handleClose),this._ws.removeEventListener("message",this._handleMessage),this._ws.removeEventListener("error",this._handleError))},e.prototype._addListeners=function(){this._ws&&(this._debug("addListeners"),this._ws.addEventListener("open",this._handleOpen),this._ws.addEventListener("close",this._handleClose),this._ws.addEventListener("message",this._handleMessage),this._ws.addEventListener("error",this._handleError))},e.prototype._clearTimeouts=function(){clearTimeout(this._connectTimeout),clearTimeout(this._uptimeTimeout)},e}();let l,h,p;function d(e){if(!l)return;const t={project:"cdn"};for(let n in e)e.hasOwnProperty(n)&&null!=e[n]&&(t[n]="value"==n||"time"==n?+e[n]||0:""+e[n]);l.send(JSON.stringify(t))}const f=window,_=f.Uint8Array&&f.WebSocket&&f.Response&&f.Map&&Array.from;const y=(e,t)=>h.send(JSON.stringify({url:e,range:t,req:"f"})),m=(e,t,n)=>new Response(e.data.slice(t,n)),g="wss://ws.getzend.digital/px";!window.XMLHttpRequestNative&&window.fetch&&window.URL&&(window.MediaSource||window.WebKitMediaSource)&&(window.XMLHttpRequestNative=window.XMLHttpRequest,window.XMLHttpRequest=function(){const e=new XMLHttpRequestNative;return e.open=function(t,n,o,r,s){if(!1===o||"GET"!=t||!/\.(ts|m3u8|webm|mpd)$/.test(n))return void XMLHttpRequestNative.prototype.open.call(this,t,n,o,r,s);const i=(t,n)=>Object.defineProperty(e,t,{value:n,configurable:!0});if(/\.(m3u8|mpd)$/.test(n))return void async function(e,t,n){let o,r;if(t("readyState",1),window.AbortController&&(r=new AbortController),e.abort=()=>{o=!0,XMLHttpRequestNative.prototype.abort.call(e),r&&r.abort()},await new Promise((t=>e.send=t)),!o)try{const s=await function(e,t,n){const o=Date.now();return Promise.race([new Promise(((e,t)=>setTimeout((()=>t("timeout")),8e3))),fetch(e,{signal:n}).then((t=>{if(t.status<200||t.status>299)throw t;return b=!0,d({hit:"http",status:t.status,time:Date.now()-o,url:e}),t.text().then((e=>({text:e,url:t.url})))}))])}(n,0,r&&r.signal);if(o)return;v(e,t,s.url,s.text)}catch(r){if(o)return;!_||r&&r.status>399&&r.status<500?(r&&r.status&&t("status",r.status),r&&r.statusText&&t("statusText",r.statusText),e.onerror&&e.onerror(r&&r.statusText||r)):(b=!1,function(e){h||(p=new Map,h=new c(e,"",{minReconnectionDelay:5e3,maxReconnectionDelay:5e3,maxEnqueuedMessages:0}),h.onmessage=e=>async function(e){const t=await m(e,0,2).arrayBuffer(),[n,o]=new Uint8Array(t);if(1===n)return console.error("[ws loader] too long url, max length 255");const r=await m(e,2,2+o).text(),s=p.get(r);if(s)if(clearTimeout(s.timer),n)s.reject(`response code ${n}`);else{const t=["blob","json","text"].includes(s.type)?s.type:"arrayBuffer";m(e,2+o)[t]().then(s.resolve)}}(e),h.onopen=()=>Array.from(p.keys()).forEach((e=>y(e))))}(g),w(e,t,n))}}(e,i,n);if(b){XMLHttpRequestNative.prototype.open.call(this,t,n,o,r,s);const i=Date.now();return void e.addEventListener("loadend",(()=>d({hit:"http",status:e.status,time:Date.now()-i,url:n})))}let u;i("readyState",1),e.send=()=>w(e,i,n,u),e.setRequestHeader=(e,t)=>{"range"==e.toLowerCase()&&(u=t)}},e},function(e){if(!l)try{l=new c(e,"",{minReconnectionDelay:1e4,maxReconnectionDelay:6e4,maxEnqueuedMessages:20})}catch(e){}}("wss://stats.myangular.life/ws"));let b=!0;function w(e,t,n,o){const r=Date.now(),s=/\.mpd$/.test(n)?"text":e.responseType;(function(e,t,n,o){return y(e,o),new Promise(((o,r)=>{const s=n?setTimeout((()=>r("timeout")),n):null;p.set(e,{resolve:o,reject:r,timer:s,type:t})})).finally((()=>{p.delete(e)}))})(n,s,e.timeout,o).then((o=>{v(e,t,n,o),d({hit:"load",sub:"ws",value:Math.round((o.byteLength||o.length)/1024),time:Date.now()-r})})).catch((t=>{console.error(t),e.onerror&&e.onerror(t)})),e.abort=()=>{!function(e){const t=p.get(e);t&&(clearTimeout(t.timer),p.delete(e))}(n),e.onabort&&e.onabort()}}function v(e,t,n,o,r,s){if(t("statusText",s||"ok"),t("status",r||200),t("response",o),t("responseURL",n),"text"==e.responseType&&t("responseText",o),t("readyState",4),e.onreadystatechange&&e.onreadystatechange({currentTarget:e}),e.onload){const t={lengthComputable:!0};t.total=t.loaded=o.byteLength||o.length,e.onload(t)}}})();